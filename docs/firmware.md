# Прошивка
Как прошить аватар, где взять файлы прошивки, как разблокировать максимальную мощность и открыть все каналы?

## Введение
Существует несколько видов устройств, работающих с цифровой системой Walksnail Avatar: цифровые очки, видеопередатчики (VTX), цифровой шлем, отдельный видеоприемник (VRX).

Внимание! Для каждого из устройств существуют отдельные прошивки, которые между собой **не совместимы** и они различаются именами файлов.

* Avatar_Sky_XX.XX.XX.img - для прошивки видеопередатчиков (VTX),
* AvatarMoonlight_Sky_XX.XX.XX.img - для прошивки видеопередатчиков Moonlight,
* AvatarMini_Gnd_XX.XX.XX.img - для прошивки цифрового шлема FatShark Recon HD,
* AvatarSE_Gnd_XX.XX.XX.img - для прошивки цифрового приемника (VRX),
* Avatar_Gnd_XX.XX.XX.img - для прошивки цифровых очков Goggles V1,
* AvatarLite_Gnd_XX.XX.XX.img - для прошивки цифровых шлема Goggles Lite,
* AvatarX_Gnd_XX.XX.XX.img - для прошивки цифровых очков Goggles Х

где XX.XX.XX - версия прошивки.

![](./assets/firmware.jpg)

## Прошивка

Процедура прошивки.

1. Загрузите файл или архив с файлами на компьютер и при необходимости распакуйте архив. (Ссылки сайты с файлами внизу страницы) 

Внимание! Для каждого из устройств существуют отдельные прошивки, которые между собой не совместимы и они различаются именами файлов.

Попытка прошить устройство не подходящим для него файлом в 97% ведет к практическому "окирпичиванию". Если и вдруг возможно восстановить - то программаторами в сервисе или на производстве. (Угадайте где?)
"Неподходящими" файлами прошивки могут случиться такие файлы как:
А. Испорченые - неправильно или неполностью загруженные. Например, Вы можете сохранить веб страницу откуда скачиваете прошивку как некоторый несъедобный для процессора устройства мусор.
Б. Не подходящий по функционалу. Например, по недоразумению соберетесь шить файл вида AvatarSE_GND_XX.XX.XX.img (для VRX) в очки или в VTX. Этого нужно избегать.

2. Найдите нужный файл прошивки для устройства. Он имеет расширение .img. где XX.XX.XX - версия прошивки.

3. Если прошиваете устройство типа очков/шлема или VRX (приемника) в котором применяется внешний накопитель на SD карте:
 - найдите подходящую SD карту
 - убедитесь, что она имеет формат FAT32, и есть свободное место не менее 40МБ.
 - также сильно рекомендуется проверить способность SD записать и прочесть какой либо файл около 40МБ. С промежуточным ИЗВЛЕЧЕНИЕМ.  Не все карты, которые симулируют запись файла - могут потом его прочесть. Это девиативное поведение карты и/или картридера, но случается.
4. Вставьте SD карту в карт ридер, найдите в системе появившийся диск, убедитесь что это та самая карта, а не другая флешка и скопируйте необходимый файл прошивки .img. Извлеките SD карту как в системе, так и механически. 
5. Вставьте SD карту в очки и подайте питание. Дождитесь окончания загрузки.
6. Если прошиваете устройства без использования SD карты для обновления (VTX) - 
- найдите нужный комплектный USB переходник для подключения к компьютеру, 
- убедитесь, что он подходит к текущему устройству (VTX), подходит по разъему;
- найдите разъем на устройстве, в который будете втыкать разъем кабеля;
- загляните в разъем, убедитесь что контакты не погнуты, нет мусора, не залиты лаком (для ногтей?) и пр.;
- определите как будете вставлять разъем кабеля, какой сторонй, уверены что разъем VTX примет его в свое лоно?
- подключите юнит к источнику питания (проверили допустимое напряжение? полярность? назначение пинов?) Питание подается по другому кабелю. Подождите некоторое время для загрузки встроенного ПО, дождитесь нужной световой индикации готовности;
- вставьте USB кабель в компьютер, и найдите появившийся диск в системе, убедитесь, что это накопитель устройства VTX;
- Скопируйте необходимый файл прошивки .img в корень накопителя и убедитесь, что файл скопировался.
- "извлеките" накопитель из системы и после механически выньте USB кабель из компьютера. Питание пока отключать не нужно.
7. Нажмите и удерживайте кнопку сопряжения (link button) на 8 секунд. Дождитесь пока VTX пока погаснет светодиод, На очках прозвучит один "бип". Кнопку можно отпустить. Чаще всегдо реакция устройств на старт обновления происходит чуть ранее, но рекомендуется удерживать 8 секунд.
8. Очки или шлем начнут медленно пищать Di....Di....Di.... а на VTX красный светодиод начнет моргать. Питание не отключаем, если не происходит ничего чрезвычайного!
9. Очки или шлем протяжно запищали - прошивка завершена успешно! 
9а. VTX перестал моргать красным (загорелся красный) и перезагрузился (моргает зеленый) - прошивка завершена успешно!

10. Если интервалы между писками очень короткие, то прошивка не удалась, причин может быть несколько: 
- устройство не смогло прочитать вашу SD-карту или файл
- неправильный файл прошивки: версия, функционал.
10а. Если на VTX после того, как зажали кнопку бинда сразу загорелся красный - прошивка не прошла.

11. Если вам необходимо установить на устройство более раннюю прошивку, то переименуйте файл .img таким образом, чтобы версия прошивки выглядела более поздней, чем та, которая сейчас установлена.

Пример: у вас на очках прошивка версии 38.40.15, а вам необходимо установить 37.42.10. 
Переименуйте скачанный файл прошивки Avatar_Gnd_37.42.10.img в Avatar_Gnd_39.40.15.img или даже в Avatar_Gnd_38.40.16.img и затем повторите процедуру прошивки как обычно.

После прошивки версия прошивки будет обозначаться правильно.

12. Версию прошивки можно посмотреть в файле версии Avatar_version.txt, который находится там же, куда записывали файл .img. Он создается программной системой самого устройства, по результату успешной прошивки.
13. Рекомендуется этот имеющийся файл версии удалять с SD карты или накопителя VTX, перед копированием файла прошивки.
14. Если после попытки прошивки такой файл не создался на накопителе устройства, то прошивка не удалась. 
Проверяйте, повторяйте.

_(авторы @Sane4ekc, @CatRovacer57)_


## Статусы VTX:
* Зеленый моргает медленно - не исправность камеры/шлейфа/ не подключена камера.
* красный мигает быстро - идет процесс прошивки 
* красный горит - не прошился
* зеленый горит - бинд произошел
* красный-зеленый моргает медленно - подключен по USB
* зеленый моргает быстро - ждет бинда

После подачи питания полностью исправный юнит следует медленный мигание зеленым, коротким и далее постоянное свечение.


## Хак (FCC режим)

Процедура разлочки (добавление всех 8 каналов, увеличение мощности до 1200мВт)
1. Для разлочки вам необходимо положить в корень SD-карты очков (или VRX) два текстовых файла:
- Avatar_std.txt (с цифрой 2 внутри) разлочка всех 8 каналов
- Avatar_pwr.txt (с цифрой 1 внутри) разлочка мощности
2. Вставьте SD-карту в очки, подайте питание и дождитесь их полного включения.
3. Процедура разлочки завершена.

## Официальная документация

🖥 Мануалы, прошивки, ченджлоги внизу страницы: https://caddxfpv.com/pages/download


🔧 Процедура перевода в fcc и добавления 1200мВт в конце статьи (UNLOCK PROCEDURE): https://fatshark.helpscoutdocs.com/article/174-dominator-with-avatarhd


💾 Файлы прошивки лежат тут: https://github.com/D3VL/Avatar-Firmware-Updates/tree/main/_firmwares, удобнее смотреть вместе с ченджлогом здесь - https://walksnail.app/firmware
